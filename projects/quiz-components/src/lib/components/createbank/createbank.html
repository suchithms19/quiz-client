<div class="createbank">
  <div class="createbank__header">
    <h1 class="createbank__header-title">Create Quiz Bank</h1>
  </div>

  <div class="createbank__container">
    <form class="createbank__form" (ngSubmit)="onSubmit()" #quizForm="ngForm" novalidate>
      
      <div class="createbank__section">
        <h2 class="createbank__section-title">Quiz Information</h2>
        
        <div class="createbank__form-group">
          <label for="quiz_name" class="createbank__form-group-label">Quiz Name <span style="color: red;">*</span> </label>
          <input 
            type="text" 
            id="quiz_name" 
            name="quiz_name"
            [(ngModel)]="quizData.name" 
            required
            placeholder="Enter quiz name"
            class="createbank__input"
            #quizNameInput="ngModel"
            [class.createbank__input--error]="quizNameInput.invalid && quizNameInput.touched">
          <div class="createbank__error-message" *ngIf="quizNameInput.invalid && quizNameInput.touched">
            <span *ngIf="quizNameInput.errors?.['required']">Quiz name is required</span>
          </div>
        </div>
        
        <div class="createbank__form-group">
          <label for="category" class="createbank__form-group-label">Category <span style="color: red;">*</span> </label>
          <select 
            id="category" 
            name="category"
            [(ngModel)]="quizData.category" 
            required
            class="createbank__input"
            #categoryInput="ngModel"
            [class.createbank__input--error]="categoryInput.invalid && categoryInput.touched">
            <option value="">Select a category</option>
            <option value="programming">Programming</option>
            <option value="mathematics">Mathematics</option>
            <option value="science">Science</option>
            <option value="history">History</option>
            <option value="language">Language</option>
            <option value="general">General Knowledge</option>
            <option value="other">Other</option>
          </select>
          <div class="createbank__error-message" *ngIf="categoryInput.invalid && categoryInput.touched">
            <span *ngIf="categoryInput.errors?.['required']">Please select a category</span>
          </div>
        </div>

        <div class="createbank__form-group">
          <label for="status" class="createbank__form-group-label">Status <span style="color: red;">*</span></label>
          <div class="radio-group">
            <label class="radio-label">
              <input 
                type="radio" 
                name="status" 
                [value]="true" 
                [(ngModel)]="quizData.status" 
                required>
              <span class="radio-custom"></span>
              Active
            </label>
            <label class="radio-label">
              <input 
                type="radio" 
                name="status" 
                [value]="false" 
                [(ngModel)]="quizData.status" 
                required>
              <span class="radio-custom"></span>
              Inactive
            </label>
          </div>
        </div>
      </div>

      <div class="createbank__section">
        <div class="createbank__section-header">
          <h2>Questions - {{ quizData.questions.length }}</h2>
          <button type="button" class="createbank__btn createbank__btn--add-question" (click)="addQuestion()">
            + Add Question
          </button>
        </div>

        <div class="createbank__questions-list" *ngIf="quizData.questions.length > 0">
          <div 
            class="createbank__questions-item" 
            *ngFor="let question of quizData.questions; let questionIndex = index">
            
            <div class="createbank__questions-header">
              <h3>Question {{ questionIndex + 1 }}</h3>
              <button 
                type="button" 
                class="createbank__btn createbank__btn--remove" 
                (click)="removeQuestion(questionIndex)"
                [disabled]="quizData.questions.length <= 1">
                Remove
              </button>
            </div>

            <div class="createbank__form-group">
              <label [for]="'question_' + questionIndex" class="createbank__form-group-label">Question Text <span style="color: red;">*</span></label>
              <textarea 
                [id]="'question_' + questionIndex"
                [name]="'question_' + questionIndex"
                [(ngModel)]="question.description" 
                required
                placeholder="Enter your question here..."
                class="createbank__textarea"
                rows="3"
                #questionInput="ngModel"
                [class.createbank__textarea--error]="questionInput.invalid && questionInput.touched"></textarea>
              <div class="createbank__error-message" *ngIf="questionInput.invalid && questionInput.touched">
                <span *ngIf="questionInput.errors?.['required']">Question text is required</span>
              </div>
            </div>

            <div class="options-section">
              <h4>Options</h4>
              
              <div 
                class="options-container"
                cdkDropList 
                (cdkDropListDropped)="onOptionDrop($event, questionIndex)">
                
                <div 
                  class="option-item" 
                  *ngFor="let option of question.options; let optionIndex = index"
                  cdkDrag>
                  
                  <div class="option-input-group">
                  <label class="radio-label" [attr.for]="'correct_' + questionIndex + '_' + optionIndex" (mousedown)="$event.stopPropagation()" (click)="$event.stopPropagation()">
                    <input 
                      type="radio" 
                      [id]="'correct_' + questionIndex + '_' + optionIndex"
                      [name]="'correct_' + questionIndex" 
                      [checked]="option.isCorrect"
                      (change)="setCorrectOption(questionIndex, optionIndex)"
                      (mousedown)="$event.stopPropagation()"
                      (click)="$event.stopPropagation()">
                    <span class="radio-custom"></span>
                  </label>
                  <div class="option-label">{{ getOptionLabel(optionIndex).toUpperCase() }}</div>
                  
                  <div class="option-input-wrapper" (mousedown)="$event.stopPropagation()" (click)="$event.stopPropagation()">
                    <input 
                      type="text"
                      [id]="'option_' + questionIndex + '_' + optionIndex"
                      [(ngModel)]="option.text"
                      [name]="'option_' + questionIndex + '_' + optionIndex"
                      required
                      placeholder="Enter answer option..."
                      class="createbank__input option-text"
                      #optionInput="ngModel"
                      [class.createbank__input--error]="optionInput.invalid && optionInput.touched"
                      (mousedown)="$event.stopPropagation()"
                      (click)="$event.stopPropagation()"
                      cdkDragDisabled>
                    <div class="createbank__error-message createbank__error-message--option" *ngIf="optionInput.invalid && optionInput.touched">
                      <span *ngIf="optionInput.errors?.['required']">Option text is required</span>
                    </div>
                  </div>
                  
                  <button 
                    type="button" 
                    class="createbank__btn createbank__btn--remove" 
                    (click)="removeOption(questionIndex, optionIndex)"
                    (mousedown)="$event.stopPropagation()"
                    [disabled]="question.options.length <= 2">
                    ×
                  </button>
                  
                  <!-- Drag Handle -->
                  <div class="drag-handle" cdkDragHandle>
                    <span class="drag-icon">⋮⋮</span>
                  </div>
                </div>
              </div>
              </div>

              <button 
                type="button"
                *ngIf="question.options.length < 4"
                class="createbank__btn createbank__btn--add-option" 
                (click)="addOption(questionIndex)">
                + Add Option
              </button>
            </div>
          </div>
        </div>

        <div class="empty-state" *ngIf="quizData.questions.length === 0">
          <p>No questions added yet. Click "Add Question" to get started!</p>
        </div>
      </div>

      <div class="createbank__section submit-section">
        <!-- Status Messages -->
        <div class="createbank__status">
          <div class="createbank__status-success" *ngIf="successMessage">
            {{ successMessage }}
          </div>
          <div class="createbank__status-error" *ngIf="validationError">
            {{ validationError }}
          </div>
          <div class="createbank__status-error" *ngIf="errorMessage$ | async as errorMessage">
            {{ errorMessage }}
          </div>
        </div>
        
        <div class="form-actions">
          <button 
            type="button" 
            class="createbank__btn createbank__btn--secondary" 
            (click)="showResetConfirmation()">
            Reset Form
          </button>
          <button 
            type="submit" 
            class="createbank__btn createbank__btn--primary">
            <span *ngIf="isLoading$ | async">Creating...</span>
            <span *ngIf="!(isLoading$ | async)">Create Quiz Bank</span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="confirmation-modal" *ngIf="showConfirmation" (click)="closeConfirmation()">
  <div class="confirmation-modal__content" (click)="$event.stopPropagation()">
    <div class="confirmation-modal__header">
      <h3>Confirm Reset</h3>
      <button class="confirmation-modal__close" (click)="closeConfirmation()">&times;</button>
    </div>
    <div class="confirmation-modal__body">
      <p>Are you sure you want to reset the form? All your progress will be lost.</p>
    </div>
    <div class="confirmation-modal__footer">
      <button class="createbank__btn createbank__btn--secondary" (click)="closeConfirmation()">
        Cancel
      </button>
      <button class="createbank__btn createbank__btn--danger" (click)="confirmReset()">
        Reset Form
      </button>
    </div>
  </div>
</div>